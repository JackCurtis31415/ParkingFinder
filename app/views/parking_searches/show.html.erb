
<!DOCTYPE html>
  <% place_query = Rack::Utils.escape(@parking_search.address + @parking_search.city + @parking_search.state) %>
  <% google_key = ENV['GOOGLE_MAP_KEY'] %>
<html>
  <head>
    <style type="text/css">
      html, body { height: 100%; margin: 0; padding: 0;}
      #map-canvas {
        width: 500px;
        height: 400px;
      }
    </style>
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=<%="#{google_key}"%>">
    </script>
    <script type="text/javascript">
      function initialize() {
      var myLatlng = new google.maps.LatLng(<%=@parking_search.lat%>, <%= @parking_search.lon %>);
      <% if @parking_venues %>
      
      <% @parking_venues.each_with_index do |venue, i| %>            

         venueLatLng<%=i%> = new google.maps.LatLng(<%=venue.lat%>, <%= venue.lon %>);

            infowindow<%=i%> = new google.maps.InfoWindow({
                content: '<%= venue.location_name %>, <%= @search_venue_sets[i].price_formated %>'
            });
      
      <% end %>

        var mapOptions = {
          center: myLatlng,
          zoom: 16
        };
      
        var map = new google.maps.Map(document.getElementById('map-canvas'),
      mapOptions);

      var contentString = 'Destination';

      var infowindow = new google.maps.InfoWindow({
      content: contentString
      });
      
      var marker = new google.maps.Marker({
          position: myLatlng,
          map: map,
          animation: google.maps.Animation.DROP,
          title: 'Destination!'
      });

      infowindow.open(map, marker);
      google.maps.event.addListener(marker, 'click', function() {
        infowindow.open(map,marker);
      });


      <% @parking_venues.each_with_index do |venue, i| %>            

      var marker<%=i%> = new google.maps.Marker({
          position: venueLatLng<%=i%>,
          map: map,
          animation: google.maps.Animation.DROP,
          title: 'Parking Venue'
      });

      infowindow<%=i%>.open(map, marker<%=i%>);
      google.maps.event.addListener(marker<%=i%>, 'click', function() {
        infowindow<%=i%>.open(map,marker<%=i%>);
      });

      <% end %>      

      <% end %>

      
      }

      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  </head>

  <body>

  

<div class="row center">

  <h1><%= @parking_search.address.titleize %></h1>
  </br>
  <h2 style="margin-top:50px">Parking Venues</h2>

  <% if @parking_venues %>
    <table>
      <tr>
        <th>Location</th>
        <th>Address</th>
        <th>Price</th>
        <th>Distance (miles)</th>
      </tr>

      <% @parking_venues.each_with_index do |venue, i| %>
      <tr>
        <td><%= venue.location_name %></td>
        <td><%= venue.address %></td>
        <td><%= @search_venue_sets[i].price_formated %></td>
        <td><%= (@search_venue_sets[i].distance / 5280.0).round(2) %></td>	
      </tr>
      <% end %>
    </table>
  <% end %>
  <div id="map-canvas"></div>  
  <br>
  <br>
  <%= link_to "Back", new_parking_search_path, class: :button %>
  <br>
</div>



</body>

</html>




